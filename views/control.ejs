<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice System</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body class="light-gray-bg">
    <%- include('../views/components/partials/sidebar.ejs') %>
    <div class="content">
        <div class="container mt-4">
            <h1 class="mt-2">Control Details</h1>
            <div class="button-box p-3 border d-flex justify-content-center align-items-center">
                <button class="btn btn-primary btn-lg client-button mx-2" id="sendButton">Send</button>
                <button class="btn btn-primary btn-lg client-button mx-2" id="historyButton">History</button>
            </div>
            <div id="sendEmailContent">
                <%- include('../views/control/sendEmail.ejs') %>
            </div>
            <div id="historyContent" style="display:none;">
                <%- include('../views/control/history.ejs') %>
            </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/script.js"></script>
    <script>
        // JavaScript to handle sending an email
        $(document).ready(function() {
            $("#sendEmailButton").on("click", function() {
                // Retrieve values from the form
                var selectedTemplate = $("#templateSelect").val();
                var bodyMessage = $("#body").val();
                var attachment = $("#attachment")[0].files[0]; // Assuming you only select one file
                var clientAddress = "client@example.com"; // Replace with the actual client address
    
                // Create a FormData object to send the data, including the attachment
                var formData = new FormData();
                formData.append("selectedTemplate", selectedTemplate);
                formData.append("bodyMessage", bodyMessage);
                formData.append("attachment", attachment);
                formData.append("clientAddress", clientAddress);
    
                $.ajax({
                    type: "POST",
                    url: "/sendEmail", // Replace with the actual endpoint
                    data: formData,
                    contentType: false,
                    processData: false,
                    success: function(response) {
                        // Handle the response if needed
                    },
                    error: function(error) {
                        // Handle errors if the request fails
                    }
                });
            });
        });
    </script>    
</body>
</html>
